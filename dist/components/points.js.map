{"version":3,"file":"points.js","sources":["../../src/components/points.gts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2026\n */\n\nimport Component from '@glimmer/component';\nimport { cached } from '@glimmer/tracking';\nimport { not, or } from 'ember-truth-helpers';\n\nimport { Encoding } from '../utils/encoding.ts';\nimport { ScaleLinear, ScaleOrdinal, ScaleSqrt } from '../utils/scale.ts';\nimport { scaleFrom, qualifyScale } from '../utils/mark-utils.ts';\nimport CSSRange from '../utils/css-range.ts';\n\nimport type { Accessor } from '../utils/encoding.ts';\nimport type { Scale } from '../utils/scale.ts';\n\nexport interface PointsArgs {\n  Args: {\n    data: any[];\n    x: Accessor;\n    y: Accessor;\n    size: Accessor;\n    color?: Accessor;\n    xScale?: Scale;\n    yScale?: Scale;\n    sizeScale?: Scale;\n    colorScale?: Scale | string;\n    renderCircles?: boolean;\n  };\n\n  Blocks: {\n    default: [PointDatum[]];\n  };\n\n  Element: SVGCircleElement;\n}\n\nexport type PointDatum = {\n  x: number;\n  y: number;\n  size: number;\n  fill?: string;\n  cssClass?: string;\n  datum: any;\n};\n\nexport default class Points extends Component<PointsArgs> {\n  @cached\n  get x() {\n    return new Encoding(this.args.x);\n  }\n\n  @cached\n  get y() {\n    return new Encoding(this.args.y);\n  }\n\n  @cached\n  get size() {\n    return new Encoding(this.args.size);\n  }\n\n  @cached\n  get color() {\n    if (this.args.color) return new Encoding(this.args.color);\n    return undefined;\n  }\n\n  @cached\n  get xScale() {\n    const scale = scaleFrom(this.args.x, this.args.xScale) || new ScaleLinear();\n    qualifyScale(this, scale, this.x, 'x');\n    return scale;\n  }\n\n  @cached\n  get yScale() {\n    const scale = scaleFrom(this.args.y, this.args.yScale) || new ScaleLinear();\n    qualifyScale(this, scale, this.y, 'y');\n    return scale;\n  }\n\n  @cached\n  get sizeScale() {\n    const scale =\n      scaleFrom(this.args.size, this.args.sizeScale) || new ScaleSqrt();\n    qualifyScale(this, scale, this.size, 'size');\n    return scale;\n  }\n\n  // When there is no color scale, don't color-code drawn points\n  @cached\n  get colorScale(): Scale | undefined {\n    const scale = this.args.colorScale;\n\n    if (scale && this.color) {\n      if (scale instanceof Object) return scale;\n\n      return new ScaleOrdinal({\n        domain: Array.from(\n          new Set(this.args.data.map((d) => this.color?.accessor(d))),\n        ),\n        range: new CSSRange(scale),\n      });\n    }\n\n    return undefined;\n  }\n\n  @cached\n  get useCSSClass() {\n    return (\n      this.colorScale instanceof Object &&\n      this.colorScale.range instanceof CSSRange\n    );\n  }\n\n  @cached\n  get points(): PointDatum[] {\n    if (!this.xScale.isValid || !this.yScale.isValid || !this.sizeScale.isValid)\n      return [];\n\n    return this.args.data.map((d: any) => {\n      const point: PointDatum = {\n        x: this.xScale.compute(this.x.accessor(d)),\n        y: this.yScale.compute(this.y.accessor(d)),\n        size: this.sizeScale.compute(this.size.accessor(d)),\n        datum: d,\n      };\n\n      if (this.colorScale && this.color) {\n        const colorValue = this.colorScale.compute(this.color.accessor(d));\n        if (this.useCSSClass) {\n          point.cssClass = colorValue;\n        } else {\n          point.fill = colorValue;\n        }\n      }\n\n      return point;\n    });\n  }\n\n  <template>\n    {{#if (or @renderCircles (not (has-block)))}}\n      {{#each this.points as |p|}}\n        <circle\n          cx={{p.x}}\n          cy={{p.y}}\n          r={{p.size}}\n          fill={{p.fill}}\n          class={{p.cssClass}}\n          ...attributes\n        ></circle>\n      {{/each}}\n    {{/if}}\n\n    {{#if (has-block)}}\n      {{yield this.points}}\n    {{/if}}\n  </template>\n}\n"],"names":["Points","Component","x","Encoding","args","n","prototype","cached","y","size","color","undefined","xScale","scale","scaleFrom","ScaleLinear","qualifyScale","yScale","sizeScale","ScaleSqrt","colorScale","Object","ScaleOrdinal","domain","Array","from","Set","data","map","d","accessor","range","CSSRange","useCSSClass","points","isValid","point","compute","datum","colorValue","cssClass","fill","setComponentTemplate","precompileTemplate","strictMode","scope","or","not"],"mappings":"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"}