{"version":3,"file":"axis.js","sources":["../../src/components/axis.gts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2026\n */\n\nimport Component from '@glimmer/component';\nimport { cached } from '@glimmer/tracking';\nimport { eq } from 'ember-truth-helpers';\n\nimport type { Scale } from '../utils/scale.ts';\n\n// String literal types for component args\nexport type OrientationType = 'top' | 'right' | 'bottom' | 'left';\nexport type DirectionType = 'vertical' | 'horizontal';\n\n// Keep enums for backward compatibility\nexport enum Orientation {\n  Top = 'top',\n  Right = 'right',\n  Bottom = 'bottom',\n  Left = 'left',\n}\n\n// Internal numeric mapping for orientation comparisons\nconst OrientationInt = {\n  top: 1,\n  right: 2,\n  bottom: 3,\n  left: 4,\n} as const;\n\ntype OrientationIntValue = (typeof OrientationInt)[OrientationType];\n\nexport enum Direction {\n  Vertical = 'vertical',\n  Horizontal = 'horizontal',\n}\n\nexport interface AxisSignature {\n  Args: {\n    scale: Scale;\n    orientation: OrientationType;\n    tickCount?: number;\n    tickValues?: any[];\n    tickFormat?: (t: any) => string;\n    tickSize?: number;\n    tickSizeInner?: number;\n    tickSizeOuter?: number;\n    tickPadding?: number;\n    offset?: number;\n    includeDomain?: boolean;\n  };\n\n  Blocks: {\n    default: [Tick, number];\n  };\n\n  Element: SVGGElement;\n}\n\nexport type Tick = {\n  transform: string;\n  size: number;\n  offset: number;\n  textOffset: string;\n  label: string;\n  textAnchor: string;\n  value: any;\n};\n\nconst DEFAULT_OFFSET =\n  typeof window !== 'undefined' && window.devicePixelRatio > 1 ? 0 : 0.5;\nconst TEXT_OFFSET: Record<OrientationIntValue, string> = {\n  [OrientationInt.top]: '0em',\n  [OrientationInt.right]: '0.32em',\n  [OrientationInt.bottom]: '0.71em',\n  [OrientationInt.left]: '0.32em',\n};\nconst TEXT_ANCHOR: Record<OrientationIntValue, string> = {\n  [OrientationInt.top]: 'middle',\n  [OrientationInt.right]: 'start',\n  [OrientationInt.bottom]: 'middle',\n  [OrientationInt.left]: 'end',\n};\n\nexport default class Axis extends Component<AxisSignature> {\n  @cached\n  get tickCount() {\n    return this.args.tickCount ?? null;\n  }\n\n  @cached\n  get tickValues() {\n    return this.args.tickValues ?? null;\n  }\n\n  @cached\n  get tickFormat() {\n    return this.args.tickFormat ?? null;\n  }\n\n  @cached\n  get tickSizeInner() {\n    return this.args.tickSizeInner ?? this.args.tickSize ?? 6;\n  }\n\n  @cached\n  get tickSizeOuter() {\n    return this.args.tickSizeOuter ?? this.args.tickSize ?? 6;\n  }\n\n  @cached\n  get tickPadding() {\n    return this.args.tickPadding ?? 3;\n  }\n\n  @cached\n  get offset() {\n    return this.args.offset ?? DEFAULT_OFFSET;\n  }\n\n  get includeDomain() {\n    return this.args.includeDomain ?? true;\n  }\n\n  @cached\n  get orientation(): OrientationIntValue {\n    return OrientationInt[this.args.orientation];\n  }\n\n  @cached\n  get direction(): DirectionType {\n    return this.orientation === OrientationInt.left ||\n      this.orientation === OrientationInt.right\n      ? 'vertical'\n      : 'horizontal';\n  }\n\n  @cached\n  get position() {\n    const copy = this.args.scale.d3Scale.copy();\n    if (copy.bandwidth) {\n      let offset = Math.max(0, copy.bandwidth() - this.offset * 2) / 2;\n      if (copy.round()) offset = Math.round(offset);\n      return (d: number) => +copy(d) + offset;\n    }\n    return (d: number) => +copy(d);\n  }\n\n  // This hints at the tick orientation top/left one way, bottom/right the other way\n  @cached\n  get k(): number {\n    const orientation = this.orientation;\n    return orientation === OrientationInt.top ||\n      orientation === OrientationInt.left\n      ? -1\n      : 1;\n  }\n\n  @cached\n  get domainPath(): string {\n    const { tickSizeOuter, offset, k } = this;\n    const range = this.args.scale.d3Scale.range();\n\n    const range0 = range[0] + offset;\n    const range1 = range[range.length - 1] + offset;\n\n    if (this.direction === 'vertical') {\n      return tickSizeOuter !== 0\n        ? `M${k * tickSizeOuter},${range0}H${offset}V${range1}H${\n            k * tickSizeOuter\n          }`\n        : `M${offset},${range0}V${range1}`;\n    }\n    return tickSizeOuter !== 0\n      ? `M${range0},${k * tickSizeOuter}V${offset}H${range1}V${\n          k * tickSizeOuter\n        }`\n      : `M${range0},${offset}H${range1}`;\n  }\n\n  @cached\n  get values() {\n    if (this.tickValues) return this.tickValues;\n\n    const scale = this.args.scale?.d3Scale;\n    if (scale?.ticks) {\n      return this.tickCount != null\n        ? scale.ticks(this.tickCount)\n        : scale.ticks();\n    }\n\n    return scale?.domain();\n  }\n\n  @cached\n  get format() {\n    if (this.tickFormat) return this.tickFormat;\n    if (this.args.scale.d3Scale.tickFormat)\n      return this.args.scale.d3Scale.tickFormat();\n    return (x: any) => x;\n  }\n\n  @cached\n  get spacing() {\n    return Math.max(this.tickSizeInner, 0) + this.tickPadding;\n  }\n\n  @cached\n  get ticks(): Tick[] {\n    const {\n      k,\n      format,\n      spacing,\n      tickSizeInner,\n      offset,\n      position,\n      direction,\n      orientation,\n    } = this;\n\n    return this.values.map((v: any) => ({\n      transform:\n        direction === 'horizontal'\n          ? `translate(${position(v) + offset},0)`\n          : `translate(0,${position(v) + offset})`,\n      size: k * tickSizeInner,\n      offset: k * spacing,\n      textOffset: TEXT_OFFSET[orientation],\n      label: format(v),\n      textAnchor: TEXT_ANCHOR[orientation],\n      value: v,\n    }));\n  }\n\n  <template>\n    <svg>\n      <g class=\"axis\" ...attributes>\n        {{#if this.includeDomain}}\n          <path\n            class=\"domain\"\n            stroke=\"currentColor\"\n            d={{this.domainPath}}\n          ></path>\n        {{/if}}\n\n        {{#if (eq this.direction \"horizontal\")}}\n\n          {{#each this.ticks key=\"@index\" as |tick index|}}\n            <g transform={{tick.transform}}>\n              {{#if (has-block)}}\n                {{yield tick index}}\n              {{else}}\n                <line stroke=\"currentColor\" y2={{tick.size}}></line>\n                {{#if tick.label}}\n                  <text\n                    fill=\"currentColor\"\n                    y={{tick.offset}}\n                    dy={{tick.textOffset}}\n                    text-anchor={{tick.textAnchor}}\n                  >{{tick.label}}</text>\n                {{/if}}\n              {{/if}}\n            </g>\n          {{/each}}\n\n        {{else}}\n\n          {{#each this.ticks key=\"@index\" as |tick index|}}\n            <g transform={{tick.transform}}>\n              {{#if (has-block)}}\n                {{yield tick index}}\n              {{else}}\n                <line stroke=\"currentColor\" x2={{tick.size}}></line>\n                {{#if tick.label}}\n                  <text\n                    fill=\"currentColor\"\n                    x={{tick.offset}}\n                    dy={{tick.textOffset}}\n                    text-anchor={{tick.textAnchor}}\n                  >{{tick.label}}</text>\n                {{/if}}\n              {{/if}}\n            </g>\n          {{/each}}\n\n        {{/if}}\n      </g>\n    </svg>\n  </template>\n}\n"],"names":["Orientation","OrientationInt","top","right","bottom","left","Direction","DEFAULT_OFFSET","window","devicePixelRatio","TEXT_OFFSET","TEXT_ANCHOR","Axis","Component","tickCount","args","n","prototype","cached","tickValues","tickFormat","tickSizeInner","tickSize","tickSizeOuter","tickPadding","offset","includeDomain","orientation","direction","position","copy","scale","d3Scale","bandwidth","Math","max","round","d","k","domainPath","range","range0","range1","length","values","ticks","domain","format","x","spacing","map","v","transform","size","textOffset","label","textAnchor","value","setComponentTemplate","precompileTemplate","strictMode","scope","eq"],"mappings":"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"}