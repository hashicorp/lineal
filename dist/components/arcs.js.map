{"version":3,"file":"arcs.js","sources":["../../src/components/arcs.gts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2026\n */\n\nimport Component from '@glimmer/component';\nimport { cached } from '@glimmer/tracking';\nimport { pie } from 'd3-shape';\n\nimport { ScaleOrdinal } from '../utils/scale.ts';\nimport { Encoding } from '../utils/encoding.ts';\nimport CSSRange from '../utils/css-range.ts';\nimport parseAngle from '../utils/parse-angle.ts';\nimport Arc from './arc.gts';\n\nimport type { PieArcDatum } from 'd3-shape';\nimport type { Scale } from '../utils/scale.ts';\nimport type { Accessor } from '../utils/encoding.ts';\n\nexport type ArcDatum = {\n  [key: string]: unknown; // Thank you TS for this gem!!\n  fill?: string;\n  cssClass?: string;\n} & PieArcDatum<number>;\n\nexport interface ArcsSignature {\n  Args: {\n    data: any[];\n    theta: Accessor;\n    color?: Accessor;\n    colorScale?: Scale | string;\n    startAngle?: number | string;\n    endAngle?: number | string;\n    padAngle?: number | string;\n    innerRadius?: number;\n    outerRadius?: number;\n    cornerRadius?: number;\n  };\n\n  Blocks: {\n    default: [ArcDatum[]];\n  };\n\n  Element: SVGPathElement;\n}\n\nexport default class Arcs extends Component<ArcsSignature> {\n  @cached\n  get theta() {\n    return new Encoding(this.args.theta);\n  }\n\n  @cached\n  get color() {\n    if (this.args.color) return new Encoding(this.args.color);\n\n    return undefined;\n  }\n\n  @cached\n  get colorScale(): Scale {\n    // colorScale can be specified as a complete scale\n    if (this.args.colorScale instanceof Object) return this.args.colorScale;\n\n    // Or it can be specified as a string provided to CSSRange\n    return new ScaleOrdinal({\n      domain: Array.from(\n        new Set(\n          this.args.data.map(\n            this.color ? (d) => this.color?.accessor(d) : (_, i) => i,\n          ),\n        ),\n      ),\n      range: new CSSRange(this.args.colorScale ?? 'lineal-arcs'),\n    });\n  }\n\n  @cached\n  get useCSSClass() {\n    return (\n      this.colorScale instanceof Object &&\n      this.colorScale.range instanceof CSSRange\n    );\n  }\n\n  @cached\n  get startAngle(): number {\n    return parseAngle(this.args.startAngle ?? 0);\n  }\n\n  @cached\n  get endAngle(): number {\n    return parseAngle(this.args.endAngle ?? Math.PI * 2);\n  }\n\n  @cached\n  get padAngle(): number {\n    return parseAngle(this.args.padAngle ?? 0);\n  }\n\n  @cached\n  get arcs() {\n    const generator = pie()\n      .startAngle(this.startAngle)\n      .endAngle(this.endAngle)\n      .padAngle(this.padAngle)\n      .value(this.theta.accessor)\n      .sortValues(null);\n\n    // Initial dataset\n    const arcsData = generator(this.args.data) as ArcDatum[];\n\n    // Augment with color classes or fills\n    arcsData.forEach((d: any, index: number) => {\n      const colorValue = this.colorScale.compute(\n        this.color ? this.color.accessor(d.data) : index,\n      );\n      if (this.useCSSClass) {\n        d.cssClass = colorValue;\n      } else {\n        d.fill = colorValue;\n      }\n    });\n\n    return arcsData;\n  }\n\n  <template>\n    {{#if (has-block)}}\n      {{yield this.arcs}}\n    {{else}}\n      {{#each this.arcs as |arc|}}\n        <Arc\n          @startAngle={{arc.startAngle}}\n          @endAngle={{arc.endAngle}}\n          @padAngle={{arc.padAngle}}\n          @innerRadius={{@innerRadius}}\n          @outerRadius={{@outerRadius}}\n          @cornerRadius={{@cornerRadius}}\n          class={{arc.cssClass}}\n          fill={{arc.fill}}\n          ...attributes\n        />\n      {{/each}}\n    {{/if}}\n  </template>\n}\n"],"names":["Arcs","Component","theta","Encoding","args","n","prototype","cached","color","undefined","colorScale","Object","ScaleOrdinal","domain","Array","from","Set","data","map","d","accessor","_","i","range","CSSRange","useCSSClass","startAngle","parseAngle","endAngle","Math","PI","padAngle","arcs","generator","pie","value","sortValues","arcsData","forEach","index","colorValue","compute","cssClass","fill","setComponentTemplate","precompileTemplate","strictMode","scope","Arc"],"mappings":"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"}