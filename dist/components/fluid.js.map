{"version":3,"file":"fluid.js","sources":["../../src/components/fluid.gts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2026\n */\n\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\n\nimport { didResize } from 'ember-resize-modifier';\n\n/**\n * A responsive container component that yields its current pixel dimensions.\n *\n * `Fluid` uses a `ResizeObserver` to track the dimensions of its containing element\n * and yields `width`, `height`, and the raw `ResizeObserverEntry` to its block.\n * This enables responsive charts that adapt to their container size.\n *\n * @example Basic usage\n * ```gts\n * <Fluid as |width height|>\n *   <svg width={{width}} height={{height}}>\n *     <!-- chart content -->\n *   </svg>\n * </Fluid>\n * ```\n *\n * ## Important: Using Scales with Mark Components\n *\n * When using Mark components (Line, Area, Arc, etc.) inside Fluid, **do not use\n * scale helpers** (e.g., `scaleLinear`) to create scales. Instead, define scales\n * as `@cached` class properties and use `.derive()` to create range-specific variants.\n *\n * ### ❌ Incorrect (causes infinite render loop)\n * ```gts\n * <Fluid as |width height|>\n *   {{#let (scaleLinear domain=this.domain range=(array 0 width)) as |xScale|}}\n *     <Line @xScale={{xScale}} ... />\n *   {{/let}}\n * </Fluid>\n * ```\n *\n * ### ✅ Correct (stable scale instances)\n * ```gts\n * import { cached } from '@glimmer/tracking';\n * import { ScaleLinear } from '@lineal-viz/lineal/utils/scale';\n *\n * class MyChart extends Component {\n *   @cached get xScale() {\n *     return new ScaleLinear({ domain: this.domain });\n *   }\n *\n *   <template>\n *     <Fluid as |width height|>\n *       {{#let (this.xScale.derive range=(array 0 width)) as |xScale|}}\n *         <Line @xScale={{xScale}} ... />\n *       {{/let}}\n *     </Fluid>\n *   </template>\n * }\n * ```\n *\n * **Why?** Scale helpers create new instances on every render. Mark components\n * call `qualifyScale()` which schedules domain updates after render. Combined\n * with Fluid's dimension updates, this creates an infinite re-render loop.\n * Using `@cached` properties with `.derive()` maintains stable scale instances.\n */\nexport interface FluidSignature {\n  Blocks: {\n    default: [number, number, ResizeObserverEntry | undefined];\n  };\n\n  Element: HTMLDivElement;\n}\n\nexport default class Fluid extends Component<FluidSignature> {\n  @tracked width = 0;\n  @tracked height = 10;\n  @tracked entry: ResizeObserverEntry | undefined;\n\n  onResize = (entry: ResizeObserverEntry) => {\n    this.width = entry.contentRect.width;\n    this.height = entry.contentRect.height;\n    this.entry = entry;\n  };\n\n  <template>\n    <div class=\"lineal-fluid\" ...attributes {{didResize this.onResize}}>\n      {{yield this.width this.height this.entry}}\n    </div>\n  </template>\n}\n"],"names":["Fluid","Component","g","prototype","tracked","i","onResize","entry","width","contentRect","height","setComponentTemplate","precompileTemplate","strictMode","scope","didResize"],"mappings":";;;;;;;AAAA;;AAEC;AAuEc,MAAMA,cAAcC,SAAA,CAAU;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,OAAA,EAAA,CAC1CC,OAAA,CAAA,EAAA,YAAA;AAAA,MAAA,OAAgB,CAAA;AAAA,IAAA,CAAA,CAAA;AAAA;EAAA,MAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,OAAA,CAAA,EAAA,MAAA;AAAA,EAAA;IAAAH,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,QAAA,EAAA,CAChBC,OAAA,CAAA,EAAA,YAAA;AAAA,MAAA,OAAiB,EAAA;AAAA,IAAA,CAAA,CAAA;AAAA;EAAA,OAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,QAAA,CAAA,EAAA,MAAA;AAAA,EAAA;IAAAH,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,OAAA,EAAA,CACjBC,OAAA,CAAA,CAAA;AAAA;EAAA,MAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,OAAA,CAAA,EAAA,MAAA;EAEDC,QAAA,GAAYC,KAAO,IAAA;AACjB,IAAA,IAAI,CAACC,KAAK,GAAGD,KAAA,CAAME,WAAW,CAACD,KAAK;AACpC,IAAA,IAAI,CAACE,MAAM,GAAGH,KAAA,CAAME,WAAW,CAACC,MAAM;IACtC,IAAI,CAACH,KAAK,GAAGA,KAAA;EACf,CAAA;AAEA,EAAA;IAAAI,oBAAA,CAAAC,kBAAA,CAAA,+HAAA,EAIA;MAAAC,UAAA,EAAA,IAAA;AAAAC,MAAAA,KAAA,EAAAA,OAAA;AAAAC,QAAAA;AAAA,OAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}