{"version":3,"file":"area.js","sources":["../../src/components/area.gts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2026\n */\n\nimport Component from '@glimmer/component';\nimport { cached } from '@glimmer/tracking';\nimport { area } from 'd3-shape';\nimport { merge } from 'd3-array';\n\nimport { Encoding } from '../utils/encoding.ts';\nimport { ScaleLinear, ScaleOrdinal } from '../utils/scale.ts';\nimport { curveFor } from '../utils/curves.ts';\nimport { scaleFrom, qualifyScale } from '../utils/mark-utils.ts';\nimport CSSRange from '../utils/css-range.ts';\nimport Stack from '../transforms/stack.ts';\n\nimport type { CurveFactory, SeriesPoint } from 'd3-shape';\nimport type { StackDatumVertical } from '../transforms/stack.ts';\nimport type { CurveArgs } from '../utils/curves.ts';\nimport type { Accessor } from '../utils/encoding.ts';\nimport type { Scale } from '../utils/scale.ts';\n\ntype MaybeStackDatum = StackDatumVertical & SeriesPoint<any>;\n\nexport interface AreaSignature {\n  Args: {\n    data: any[];\n    x?: Accessor;\n    y?: Accessor;\n    y0?: Accessor;\n    color?: Accessor;\n    xScale?: Scale;\n    yScale?: Scale;\n    colorScale?: Scale | string;\n    curve?: string | CurveArgs;\n    defined?: (d: any) => boolean;\n  };\n\n  Blocks: {\n    default: [];\n  };\n\n  Element: SVGPathElement;\n}\n\nexport interface AreaSeries {\n  d: string | null;\n  fill?: string;\n  cssClass?: string;\n}\n\nexport default class Area extends Component<AreaSignature> {\n  @cached\n  get x() {\n    return new Encoding(this.args.x ?? 'x');\n  }\n\n  @cached\n  get y() {\n    return new Encoding(this.args.y ?? 'y');\n  }\n\n  @cached\n  get y0() {\n    if (this.args.y0) return new Encoding(this.args.y0);\n    return undefined;\n  }\n\n  @cached\n  get color() {\n    if (this.args.color) return new Encoding(this.args.color);\n\n    return undefined;\n  }\n\n  @cached\n  get xScale() {\n    const scale =\n      scaleFrom(this.args.x ?? 'x', this.args.xScale) || new ScaleLinear();\n    if (this.isStacked) {\n      qualifyScale(this, scale, new Encoding('x'), 'x', merge(this.data));\n    } else {\n      qualifyScale(this, scale, this.x, 'x');\n    }\n\n    return scale;\n  }\n\n  @cached\n  get yScale() {\n    const scale =\n      scaleFrom(this.args.y ?? 'y', this.args.yScale) || new ScaleLinear();\n\n    // When the data is stacked, the scale must be qualified using the computed\n    // stack data since the cumulative y-values for an x-value will be greater than\n    // any individual y-value in the original dataset.\n    if (this.isStacked) {\n      qualifyScale(this, scale, new Encoding('y'), 'y', merge(this.data));\n    } else {\n      qualifyScale(this, scale, this.y, 'y');\n    }\n    return scale;\n  }\n\n  @cached\n  get categories(): undefined | any[] {\n    if (this.isStacked) {\n      return this.data.map((series) => series.key);\n    }\n\n    return undefined;\n  }\n\n  @cached\n  get isStacked(): boolean {\n    return !!this.color || this.args.data[0] instanceof Array;\n  }\n\n  @cached\n  get data(): any[] {\n    // When data isn't stacked, pass through\n    if (!this.isStacked) return this.args.data;\n\n    // When data is already stacked, pass through\n    if (this.args.data[0] instanceof Array) return this.args.data;\n\n    // Finally, stack data that should be stacked but isn't yet\n    // At this point, we know this.args.color exists because isStacked is true\n    // and data[0] is not an Array (we checked above)\n    return new Stack({\n      x: this.args.x ?? 'x',\n      y: this.args.y ?? 'y',\n      z: this.args.color!,\n      data: this.args.data,\n    }).data;\n  }\n\n  // When there is no color scale, don't color-code drawn points\n  @cached\n  get colorScale(): Scale | undefined {\n    const scale = this.args.colorScale;\n\n    if (scale && this.isStacked) {\n      if (scale instanceof Object) return scale;\n\n      return new ScaleOrdinal({\n        domain: Array.from(this.categories ?? []),\n        range: new CSSRange(scale),\n      });\n    }\n\n    return undefined;\n  }\n\n  @cached\n  get useCSSClass() {\n    return (\n      this.colorScale instanceof Object &&\n      this.colorScale.range instanceof CSSRange\n    );\n  }\n\n  @cached\n  get curve(): CurveFactory {\n    return curveFor(this.args.curve) as CurveFactory;\n  }\n\n  @cached\n  get d() {\n    if (!this.xScale.isValid || !this.yScale.isValid) return '';\n\n    if (this.isStacked) {\n      const generator = area<MaybeStackDatum>()\n        .curve(this.curve)\n        .x((d) => this.xScale.compute(d.x))\n        .y0((d) => this.yScale.compute(d.y0))\n        .y1((d) => this.yScale.compute(d.y1));\n\n      return this.data.map((series) => {\n        const d: AreaSeries = { d: generator(series) };\n        if (this.colorScale) {\n          const colorValue = this.colorScale.compute(series.key);\n          if (this.useCSSClass) {\n            d.cssClass = colorValue;\n          } else {\n            d.fill = colorValue;\n          }\n        }\n        return d;\n      });\n    } else {\n      const generator = area()\n        .curve(this.curve)\n        .defined(\n          this.args.defined ||\n            ((d) => this.y.accessor(d) != null && this.x.accessor(d) != null),\n        )\n        .x((d) => this.xScale.compute(this.x.accessor(d)))\n        .y0((d) => this.yScale.compute(this.y0?.accessor(d) ?? 0))\n        .y1((d) => this.yScale.compute(this.y.accessor(d)));\n\n      return generator(this.args.data);\n    }\n  }\n\n  <template>\n    {{#if this.isStacked}}\n      <g>\n        {{! @glint-expect-error }}\n        {{#each this.d as |d|}}\n          <path\n            d={{d.d}}\n            fill={{d.fill}}\n            class={{d.cssClass}}\n            ...attributes\n          ></path>\n        {{/each}}\n      </g>\n    {{else}}\n      {{! @glint-expect-error }}\n      <path d={{this.d}} ...attributes></path>\n    {{/if}}\n  </template>\n}\n"],"names":["Area","Component","x","Encoding","args","n","prototype","cached","y","y0","undefined","color","xScale","scale","scaleFrom","ScaleLinear","isStacked","qualifyScale","merge","data","yScale","categories","map","series","key","Array","Stack","z","colorScale","Object","ScaleOrdinal","domain","from","range","CSSRange","useCSSClass","curve","curveFor","d","isValid","generator","area","compute","y1","colorValue","cssClass","fill","defined","accessor","setComponentTemplate","precompileTemplate","strictMode"],"mappings":"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"}