{"version":3,"file":"interactor-cartesian-horizontal.js","sources":["../../src/modifiers/interactor-cartesian-horizontal.ts"],"sourcesContent":["/**\n * Copyright IBM Corp. 2020, 2026\n */\n\nimport { modifier } from 'ember-modifier';\nimport { bisector } from 'd3-array';\n\nimport { Encoding } from '../utils/encoding.ts';\n\nimport type { Accessor } from '../utils/encoding.ts';\nimport type { Scale } from '../utils/scale.ts';\n\n/**\n * The available arguments to the `interactor-cartesian-horizontal` modifier.\n */\nexport interface InteractorArgs {\n  /** A dataset of any type of data. */\n  data: any[];\n  /** The scale the represents the x-axis of the plot being interacted with. */\n  xScale: Scale;\n  /** The accessor for the x encoding of the plot being interacted with. */\n  x: Accessor;\n  /** The accessor (or accessors) for looking up data encoded on the y-axis. */\n  y: Accessor | Accessor[];\n  /** How sensitive rounding is when determining if near data should be included in\n   * a selection. Measured in pixel space (i.e., after values have been computed by scales). */\n  distanceThreshold: number;\n  /** Called when the the modified element receives mouse movement or left/right arrow key input. */\n  onSeek?: (data: ActiveData | null) => void;\n  /** Called when the the modified element receives mouse click or space/enter key input. */\n  onSelect?: (datum: ActiveDatum | null) => void;\n}\n\nexport interface ActiveDatum {\n  /** The encoding that corresponds to the `datum`. Useful for determining which\n   * series the `datum` belongs to. */\n  encoding: Encoding;\n  /** An element from the data array provided to the Modifier. */\n  datum: any;\n}\n\nexport interface ActiveData {\n  /** The element from the data array provided to the Modifier that is\n   * closest to the interaction point. */\n  datum: ActiveDatum;\n  /** Surrounding data from the data array provided to the Modifier that is close\n   * to the interaction point (as determined by the `distanceThreshold`). */\n  data: ActiveDatum[];\n}\n\nenum NavKey {\n  ESC = 'Escape',\n  Enter = 'Enter',\n  Space = ' ',\n  Left = 'ArrowLeft',\n  Right = 'ArrowRight',\n}\n\nconst NAV_KEYS = Object.values(NavKey);\n\nexport default modifier(\n  (\n    element: HTMLElement,\n    _,\n    {\n      data,\n      xScale,\n      x,\n      y,\n      onSeek,\n      onSelect,\n      distanceThreshold = 10,\n    }: InteractorArgs,\n  ) => {\n    const accessors: Accessor[] = y instanceof Array ? y : [y];\n    const xEnc = new Encoding(x);\n    const yEncs = accessors.map((y) => new Encoding(y));\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const bis = bisector((d) => xEnc.accessor(d)).left;\n\n    let activeData: ActiveData | null = null;\n    let seekIndex = 0;\n\n    function getDataAtPoint(pt: number): ActiveData | null {\n      // Exit early when possible\n      if (!data.length) return null;\n\n      // Map the pixel-space value to the data-space value\n      const dx = xScale.d3Scale.invert(pt);\n\n      // For each y encoding, find the nearest datum to the data-space value\n      const activeData: ActiveDatum[] = yEncs.reduce(\n        (agg: ActiveDatum[], encoding) => {\n          // Only bisect data that has values for the current y encoding\n          const subjectData = data.filter((d) => encoding.accessor(d) != null);\n\n          if (!subjectData.length) return agg;\n\n          const index = bis(subjectData, dx, 1);\n          const dLeft = subjectData[index - 1];\n          const dRight = subjectData[index];\n\n          let datum;\n\n          // If there is only one datum, it's the active datum\n          if (dLeft && !dRight) {\n            datum = dLeft;\n          } else {\n            // Pick the closer datum\n            datum =\n              dx - xEnc.accessor(dLeft) > xEnc.accessor(dRight) - dx\n                ? dRight\n                : dLeft;\n          }\n\n          // Collect all data with the same x value as the active datum (generally means a\n          // multi-series dataset).\n          const matchVal = xEnc.accessor(datum);\n          const relatedData = subjectData.filter(\n            (d) => xEnc.accessor(d) === matchVal,\n          );\n\n          agg.push(...relatedData.map((datum) => ({ encoding, datum })));\n          return agg;\n        },\n        [],\n      );\n\n      // Now determine which of the active data is closest\n      const closestDatum = activeData\n        .slice()\n        .sort(\n          (a, b) =>\n            Math.abs(xEnc.accessor(a.datum) - dx) -\n            Math.abs(xEnc.accessor(b.datum) - dx),\n        )[0];\n\n      // Return null if no closest datum found\n      if (!closestDatum) {\n        return null;\n      }\n\n      // Finally filter out active data based on a pixel-space distance threshold\n      const dist: number = Math.abs(\n        xScale.compute(xEnc.accessor(closestDatum.datum)) - pt,\n      );\n      const filteredData = activeData.filter(\n        (d) =>\n          Math.abs(xScale.compute(xEnc.accessor(d.datum)) - pt) <\n          dist + distanceThreshold,\n      );\n\n      return {\n        datum: closestDatum,\n        data: filteredData,\n      };\n    }\n\n    function setState(points: ActiveData | null) {\n      activeData = points;\n\n      const datum = points?.datum.datum;\n      seekIndex = data.indexOf(datum);\n    }\n\n    function seek(ev: MouseEvent) {\n      const points = getDataAtPoint(ev.offsetX);\n      setState(points);\n      onSeek?.(points);\n    }\n\n    function select(ev: MouseEvent) {\n      const points = getDataAtPoint(ev.offsetX);\n      setState(points);\n      onSelect?.(points ? points.datum : null);\n    }\n\n    function clear() {\n      activeData = null;\n      onSeek?.(null);\n      onSelect?.(null);\n    }\n\n    function keyControls(ev: KeyboardEvent) {\n      const key: NavKey = ev.key as NavKey;\n\n      if (NAV_KEYS.includes(key)) {\n        ev.preventDefault();\n      }\n\n      if (key === NavKey.Space || key === NavKey.Enter) {\n        onSelect?.(activeData ? activeData.datum : null);\n      } else if (key === NavKey.ESC) {\n        onSeek?.(null);\n        onSelect?.(null);\n      } else if (key === NavKey.Right) {\n        seekIndex = (seekIndex + 1) % data.length;\n      } else if (key === NavKey.Left) {\n        seekIndex--;\n        if (seekIndex < 0) seekIndex = data.length - 1;\n      }\n\n      if (key === NavKey.Right || key === NavKey.Left) {\n        const points = getDataAtPoint(\n          xScale.compute(xEnc.accessor(data[seekIndex])),\n        );\n        setState(points);\n        onSeek?.(points);\n      }\n    }\n\n    element.addEventListener('mousemove', seek);\n    element.addEventListener('click', select);\n    element.addEventListener('mouseleave', clear);\n    element.addEventListener('keydown', keyControls);\n\n    return () => {\n      element.removeEventListener('mousemove', seek);\n      element.removeEventListener('click', select);\n      element.removeEventListener('mouseleave', clear);\n      element.removeEventListener('keydown', keyControls);\n    };\n  },\n);\n"],"names":["NavKey","NAV_KEYS","Object","values","modifier","element","_","data","xScale","x","y","onSeek","onSelect","distanceThreshold","accessors","Array","xEnc","Encoding","yEncs","map","bis","bisector","d","accessor","left","activeData","seekIndex","getDataAtPoint","pt","length","dx","d3Scale","invert","reduce","agg","encoding","subjectData","filter","index","dLeft","dRight","datum","matchVal","relatedData","push","closestDatum","slice","sort","a","b","Math","abs","dist","compute","filteredData","setState","points","indexOf","seek","ev","offsetX","select","clear","keyControls","key","includes","preventDefault","Space","Enter","ESC","Right","Left","addEventListener","removeEventListener"],"mappings":"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"}